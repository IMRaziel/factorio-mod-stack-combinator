# Tag the HEAD commit on main branch with the given version, zip up the files and publish a release
name: Publish a new version
on: 
  workflow_dispatch:
    inputs:
      version:
        description: Release version, format "1.2.3". Tag will be created as "v1.2.3", but release file will not (to comply with Factorio conventions).
        required: true
env:
  VERSION_TAG: "v${{ github.event.inputs.version }}"
jobs:
  release:
    name: Tag, zip and publish release
    runs-on: ubuntu-latest
    
    steps:
      - name: Tag latest master commit with ${{ env.VERSION-TAG }}
        uses: tvdias/github-tagger@v0.0.1
        with:
          repo-token: "${{ secrets.GITHUB_TOKEN }}"
          tag: ${{ env.VERSION-TAG }}
      - name: Create release
        id: create_release
        uses: actions/create-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tag_name: ${{ env.VERSION-TAG }}
          release_name: Release ${{ env.VERSION-TAG }}
          draft: true
          prerelease: false
      - name: Zip files
        uses: TheDoctor0/zip-release@0.4.1
        with:
          filename: "stack-combinator_${{ github.event.inputs.version_tag }}.zip"
          exclusions: "*.git*"

